{% extends "services/service_resources_harvest.html" %}

{% load i18n %}

{% block brand_details %} - {% trans "Import resources" %}: {{ service.title }}{% endblock %}

{% block body %}
    <div class="twocol">
        <div class="page-header">
            <h3>
                <small> {{ service.name }}</small>
            </h3>
        </div>
        <div class="container">
            {% if resources %}
                <p id="message">{% if errored_state %}{% trans "no" %}{% else %}
                    {{ importable|length }}{% endif %} {% trans "resources can be imported" %}
                    {% if service_handler.is_cascaded and resources %}
                        {% trans "- These will be cascaded through your local geoserver instance" %}
                    {% endif %}
                </p>
                <div class="row">
                    <form method="POST">
                        {% csrf_token %}
                        <table id="resource_table" class="table table table-hover">
                            <thead>
                            <tr>
                                <th>{% if not errored_state %}<input type="checkbox" id="checkAll"/>{% endif %}</th>
                                <th>{% trans "Id" %}</th>
                                <th>{% trans "Name" %}</th>
                                <th>{% trans "Description" %}</th>
                            </tr>

                            <tr style="background-color: lightgray">
                                {% for filter_info in  filter_row %}
                                    {% if filter_info.id %}
                                        <th>
                                            <div style="display:flex;">
                                                <input id="{{ filter_info.id }}" class="col-xs-10"
                                                       type="text" class="typeahead" data-provide="typeahead"
                                                       name="typeahead_search" autocomplete="off"
                                                       style="border-radius: 7px ; flex:1"/>
                                                <button id="btn-{{ filter_info.id }}"
                                                        class="btn fa fa-filter" style="float:right"/>
                                            </div>
                                        </th>

                                    {% else %}
                                        <th/>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                            </thead>
                            <tbody>
                            {% for resource_meta in resources %}
                                <tr>
                                    <td>
                                        {% if not errored_state %}
                                            <input {% if resource_meta.id in requested %}checked{% endif %}
                                                   type="checkbox" name="resource_list"
                                                   id="option_{{ resource_meta.id }}" value="{{ resource_meta.id }}"/>
                                        {% endif %}
                                    </td>
                                    <td>{{ resource_meta.id }}</td>
                                    <td>{{ resource_meta.title }}</td>
                                    <td>{{ resource_meta.abstract }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                        <div align="center">
                            <div class="btn-group">
                                <button id="btnClearFilter" type="button" class="btn btn-default">{% trans "Clear Filter" %}</button>
                                <a class="btn btn-default"
                                   href="{% url "service_detail" service.id %}">{% trans "Back to service details" %}</a>
                                <input type="submit" class="btn btn-primary" value="{% trans "Import Resources" %}"/>
                            </div>
                        </div>
                    </form>
                    {% if resources.paginator.num_pages > 1 %}
                        <div class="row">
                            <nav aria-label="importable resources pages">
                                <ul class="pagination hidden-xs pull-right">
                                    {% if resources.has_previous %}
                                        <li><a id="previous" aria-label="{% trans "Previous" %}"
                                               href="?page={{ resources.previous_page_number }}">{% trans "previous" %}</a></li>
                                    {% else %}
                                        <li class="disabled"><a aria-label="{% trans "Previous" %}" href="#">{% trans "previous" %}</a></li>
                                    {% endif %}
                                    <li class="active"><a
                                            href="#">{{ resources.number }}/{{ resources.paginator.num_pages }}</a></li>
                                    {% if resources.has_next %}
                                        <li><a id="next" aria-label="{% trans "Next" %}"
                                               href="?page={{ resources.next_page_number }}">{% trans "next" %}</a></li>
                                    {% else %}
                                        <li class="disabled"><a aria-label="{% trans "Next" %}" href="#">{% trans "next" %}</a></li>
                                    {% endif %}
                                </ul>
                            </nav>
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <p>{% trans "All resources have already been imported" %}</p>
            {% endif %}
            <div class="modal fade" data-backdrop="static" data-keyboard="false" id="progressModal" tabindex="-1"
                 role="dialog" aria-labelledby="progressModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            {% trans "Connecting to service..." %}
                        </div>
                        <div class="modal-body">
                            <div class="progress" id="serviceConnectionProgress">
                                <div class="progress-bar progress-bar-striped progress-bar-info active"
                                     role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"
                                     style="width: 100%;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" data-backdrop="static" data-keyboard="false" id="harvestingResourceSync"
                 tabindex="-1" role="dialog" aria-labelledby="harvestingResourceSyncLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            {% trans "Harvesting resources..." %}
                        </div>
                        <div class="modal-body">
                            <div class="progress" id="harvestingProgress">
                                <div class="progress-bar progress-bar-striped progress-bar-info active"
                                     role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"
                                     style="width: 100%;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}